<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>2. Mapper 接口 | MyBatis Mapper</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/favicon.png">
    <script>
            var _hmt = _hmt || [];
            (function() {
              var hm = document.createElement("script");
              hm.src = "https://hm.baidu.com/hm.js?a05b63ee263e1ad37bf6c8966bfe92fa";
              var s = document.getElementsByTagName("script")[0]; 
              s.parentNode.insertBefore(hm, s);
            })();
        </script>
    <script crossorigin="anonymous" async="true" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1797264872895352"></script>
    <meta name="description" content="通用 Mapper">
    
    <link rel="preload" href="/assets/css/0.styles.4fd8ad1c.css" as="style"><link rel="preload" href="/assets/js/app.982d0a79.js" as="script"><link rel="preload" href="/assets/js/2.05c8fd45.js" as="script"><link rel="preload" href="/assets/js/11.65baf78c.js" as="script"><link rel="prefetch" href="/assets/js/10.a8bd79cb.js"><link rel="prefetch" href="/assets/js/12.6184a11a.js"><link rel="prefetch" href="/assets/js/13.ecad1206.js"><link rel="prefetch" href="/assets/js/14.2ca5bee8.js"><link rel="prefetch" href="/assets/js/15.5a69d0d8.js"><link rel="prefetch" href="/assets/js/16.3d121eed.js"><link rel="prefetch" href="/assets/js/17.bf197a83.js"><link rel="prefetch" href="/assets/js/18.b87cd0b0.js"><link rel="prefetch" href="/assets/js/19.3f4a2a15.js"><link rel="prefetch" href="/assets/js/20.8c81acb8.js"><link rel="prefetch" href="/assets/js/21.1ad225ee.js"><link rel="prefetch" href="/assets/js/22.c8c90166.js"><link rel="prefetch" href="/assets/js/23.28f79614.js"><link rel="prefetch" href="/assets/js/24.06c1ba33.js"><link rel="prefetch" href="/assets/js/25.20400a37.js"><link rel="prefetch" href="/assets/js/26.a91a516f.js"><link rel="prefetch" href="/assets/js/27.bea17ee7.js"><link rel="prefetch" href="/assets/js/28.0cca3d9f.js"><link rel="prefetch" href="/assets/js/29.94bd9c22.js"><link rel="prefetch" href="/assets/js/3.9185f555.js"><link rel="prefetch" href="/assets/js/30.92ee1734.js"><link rel="prefetch" href="/assets/js/4.90120916.js"><link rel="prefetch" href="/assets/js/5.2c2483a0.js"><link rel="prefetch" href="/assets/js/6.f336762c.js"><link rel="prefetch" href="/assets/js/7.b0ec8caa.js"><link rel="prefetch" href="/assets/js/8.e6ea42ae.js"><link rel="prefetch" href="/assets/js/9.db2267c3.js">
    <link rel="stylesheet" href="/assets/css/0.styles.4fd8ad1c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.png" alt="MyBatis Mapper" class="logo"> <span class="site-name can-hide">MyBatis Mapper</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/docs/1.getting-started.html" class="nav-link">
  快速上手
</a></div><div class="nav-item"><a href="/docs/extend/1.extend-guide.html" class="nav-link">
  深度指南
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="发布版本" class="dropdown-title"><span class="title">发布版本</span> <span class="arrow down"></span></button> <button type="button" aria-label="发布版本" class="mobile-dropdown-title"><span class="title">发布版本</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/releases/1.0.0.html" class="nav-link">
  1.0.0
</a></li><li class="dropdown-item"><!----> <a href="/releases/1.0.1.html" class="nav-link">
  1.0.1
</a></li><li class="dropdown-item"><!----> <a href="/releases/1.0.3.html" class="nav-link">
  1.0.3
</a></li><li class="dropdown-item"><!----> <a href="/releases/1.0.4.html" class="nav-link">
  1.0.4
</a></li><li class="dropdown-item"><!----> <a href="/releases/1.1.0.html" class="nav-link">
  1.1.0
</a></li><li class="dropdown-item"><!----> <a href="/releases/1.2.0.html" class="nav-link">
  1.2.0
</a></li><li class="dropdown-item"><!----> <a href="/releases/1.2.x.html" class="nav-link">
  1.2.x
</a></li><li class="dropdown-item"><!----> <a href="/releases/2.0.0.html" class="nav-link">
  2.0.0
</a></li><li class="dropdown-item"><!----> <a href="/releases/2.1.0.html" class="nav-link">
  2.1.0
</a></li><li class="dropdown-item"><!----> <a href="/releases/2.1.1.html" class="nav-link">
  2.1.1
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/mybatis-mapper/mapper" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://gitee.com/mybatis-mapper/mapper" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Provider" class="dropdown-title"><span class="title">Provider</span> <span class="arrow down"></span></button> <button type="button" aria-label="Provider" class="mobile-dropdown-title"><span class="title">Provider</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/mybatis-mapper/provider" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://gitee.com/mybatis-mapper/provider" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="https://liuzh.blog.csdn.net/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  作者博客
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/docs/1.getting-started.html" class="nav-link">
  快速上手
</a></div><div class="nav-item"><a href="/docs/extend/1.extend-guide.html" class="nav-link">
  深度指南
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="发布版本" class="dropdown-title"><span class="title">发布版本</span> <span class="arrow down"></span></button> <button type="button" aria-label="发布版本" class="mobile-dropdown-title"><span class="title">发布版本</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/releases/1.0.0.html" class="nav-link">
  1.0.0
</a></li><li class="dropdown-item"><!----> <a href="/releases/1.0.1.html" class="nav-link">
  1.0.1
</a></li><li class="dropdown-item"><!----> <a href="/releases/1.0.3.html" class="nav-link">
  1.0.3
</a></li><li class="dropdown-item"><!----> <a href="/releases/1.0.4.html" class="nav-link">
  1.0.4
</a></li><li class="dropdown-item"><!----> <a href="/releases/1.1.0.html" class="nav-link">
  1.1.0
</a></li><li class="dropdown-item"><!----> <a href="/releases/1.2.0.html" class="nav-link">
  1.2.0
</a></li><li class="dropdown-item"><!----> <a href="/releases/1.2.x.html" class="nav-link">
  1.2.x
</a></li><li class="dropdown-item"><!----> <a href="/releases/2.0.0.html" class="nav-link">
  2.0.0
</a></li><li class="dropdown-item"><!----> <a href="/releases/2.1.0.html" class="nav-link">
  2.1.0
</a></li><li class="dropdown-item"><!----> <a href="/releases/2.1.1.html" class="nav-link">
  2.1.1
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/mybatis-mapper/mapper" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://gitee.com/mybatis-mapper/mapper" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Provider" class="dropdown-title"><span class="title">Provider</span> <span class="arrow down"></span></button> <button type="button" aria-label="Provider" class="mobile-dropdown-title"><span class="title">Provider</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/mybatis-mapper/provider" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://gitee.com/mybatis-mapper/provider" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="https://liuzh.blog.csdn.net/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  作者博客
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>使用指南</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/1.getting-started.html" class="sidebar-link">1.快速上手</a></li><li><a href="/docs/2.mybatis-mapper.html" aria-current="page" class="active sidebar-link">2. Mapper 接口</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/2.mybatis-mapper.html#_2-1-继承其他通用接口" class="sidebar-link">2.1 继承其他通用接口</a></li><li class="sidebar-sub-header"><a href="/docs/2.mybatis-mapper.html#_2-2-重写继承接口的定义" class="sidebar-link">2.2 重写继承接口的定义</a></li><li class="sidebar-sub-header"><a href="/docs/2.mybatis-mapper.html#_2-3-复制其他接口中的通用方法定义" class="sidebar-link">2.3 复制其他接口中的通用方法定义</a></li><li class="sidebar-sub-header"><a href="/docs/2.mybatis-mapper.html#_2-4-使用-java8-默认方法灵活实现通用方法" class="sidebar-link">2.4 使用 Java8 默认方法灵活实现通用方法</a></li><li class="sidebar-sub-header"><a href="/docs/2.mybatis-mapper.html#_2-5-通过修改接口方法的返回值和入参-就能变身无数个通用方法" class="sidebar-link">2.5 通过修改接口方法的返回值和入参，就能变身无数个通用方法</a></li></ul></li><li><a href="/docs/3.entity.html" class="sidebar-link">3. 实体类注解</a></li><li><a href="/docs/4.common.html" class="sidebar-link">4. common 模块</a></li><li><a href="/docs/5.service.html" class="sidebar-link">5. service 模块</a></li><li><a href="/docs/6.activerecord.html" class="sidebar-link">6. activerecord 模块</a></li><li><a href="/docs/7.generator.html" class="sidebar-link">7. 睿Rui - 代码生成器</a></li><li><a href="/docs/8.jpa.html" class="sidebar-link">8. JPA 注解支持</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>示例</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>深度指南</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p>基于 <strong>mybatis-mapper/provider</strong> 核心部分实现的基础的增删改查操作，提供了一个核心的 <code>io.mybatis.mapper.Mapper</code> 接口，接口定义如下：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
 * 基础 Mapper 方法，可以在此基础上继承覆盖已有方法
 *
 * @param &lt;T&gt; 实体类类型
 * @param &lt;I&gt; 主键类型
 * @author liuzh
 */</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Mapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">I</span> <span class="token keyword">extends</span> <span class="token class-name">Serializable</span><span class="token punctuation">&gt;</span></span>
    <span class="token keyword">extends</span> <span class="token class-name">EntityMapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">I</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">ExampleMapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">Example</span><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">CursorMapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">Example</span><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

  <span class="token comment">/**
   * 保存实体，默认主键自增，并且名称为 id
   * &lt;p&gt;
   * 这个方法是个示例，你可以在自己的接口中使用相同的方式覆盖父接口中的配置
   *
   * @param entity 实体类
   * @return 1成功，0失败
   */</span>
  <span class="token annotation punctuation">@Override</span>
  <span class="token annotation punctuation">@Lang</span><span class="token punctuation">(</span><span class="token class-name">Caching</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
  <span class="token annotation punctuation">@Options</span><span class="token punctuation">(</span>useGeneratedKeys <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span> keyProperty <span class="token operator">=</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span>
  <span class="token annotation punctuation">@InsertProvider</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">EntityProvider</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> method <span class="token operator">=</span> <span class="token string">&quot;insert&quot;</span><span class="token punctuation">)</span>
  <span class="token keyword">int</span> <span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">T</span> entity<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/**
   * 保存实体中不为空的字段，默认主键自增，并且名称为 id
   * &lt;p&gt;
   * 这个方法是个示例，你可以在自己的接口中使用相同的方式覆盖父接口中的配置
   *
   * @param entity 实体类
   * @return 1成功，0失败
   */</span>
  <span class="token annotation punctuation">@Override</span>
  <span class="token annotation punctuation">@Lang</span><span class="token punctuation">(</span><span class="token class-name">Caching</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
  <span class="token annotation punctuation">@Options</span><span class="token punctuation">(</span>useGeneratedKeys <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span> keyProperty <span class="token operator">=</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span>
  <span class="token annotation punctuation">@InsertProvider</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">EntityProvider</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> method <span class="token operator">=</span> <span class="token string">&quot;insertSelective&quot;</span><span class="token punctuation">)</span>
  <span class="token keyword">int</span> <span class="token function">insertSelective</span><span class="token punctuation">(</span><span class="token class-name">T</span> entity<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/**
   * 根据主键更新实体中不为空的字段，强制字段不区分是否 null，都更新
   * &lt;p&gt;
   * 当前方法来自 {@link io.mybatis.mapper.fn.FnMapper}，该接口中的其他方法用 {@link ExampleMapper} 也能实现
   *
   * @param entity            实体类
   * @param forceUpdateFields 强制更新的字段，不区分字段是否为 null，通过 {@link Fn#of(Fn...)} 创建 {@link Fn.Fns}
   * @return 1成功，0失败
   */</span>
  <span class="token annotation punctuation">@Lang</span><span class="token punctuation">(</span><span class="token class-name">Caching</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
  <span class="token annotation punctuation">@UpdateProvider</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">FnProvider</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> method <span class="token operator">=</span> <span class="token string">&quot;updateByPrimaryKeySelectiveWithForceFields&quot;</span><span class="token punctuation">)</span>
  <span class="token keyword">int</span> <span class="token function">updateByPrimaryKeySelectiveWithForceFields</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">&quot;entity&quot;</span><span class="token punctuation">)</span> <span class="token class-name">T</span> entity<span class="token punctuation">,</span> <span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">&quot;fns&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Fn<span class="token punctuation">.</span>Fns</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> forceUpdateFields<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/**
   * 根据指定字段集合查询：field in (fieldValueList)
   * &lt;p&gt;
   * 这个方法是个示例，你也可以使用 Java8 的默认方法实现一些通用方法
   *
   * @param field          字段
   * @param fieldValueList 字段值集合
   * @param &lt;F&gt;            字段类型
   * @return 实体列表
   */</span>
  <span class="token keyword">default</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">F</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">selectByFieldList</span><span class="token punctuation">(</span><span class="token class-name">Fn</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">F</span><span class="token punctuation">&gt;</span></span> field<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">F</span><span class="token punctuation">&gt;</span></span> fieldValueList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Example</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> example <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Example</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    example<span class="token punctuation">.</span><span class="token function">createCriteria</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">andIn</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Fn</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> field<span class="token punctuation">,</span> fieldValueList<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">selectByExample</span><span class="token punctuation">(</span>example<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/**
   * 根据指定字段集合删除：field in (fieldValueList)
   * &lt;p&gt;
   * 这个方法是个示例，你也可以使用 Java8 的默认方法实现一些通用方法
   *
   * @param field          字段
   * @param fieldValueList 字段值集合
   * @param &lt;F&gt;            字段类型
   * @return 实体列表
   */</span>
  <span class="token keyword">default</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">F</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">int</span> <span class="token function">deleteByFieldList</span><span class="token punctuation">(</span><span class="token class-name">Fn</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">F</span><span class="token punctuation">&gt;</span></span> field<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">F</span><span class="token punctuation">&gt;</span></span> fieldValueList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Example</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> example <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Example</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    example<span class="token punctuation">.</span><span class="token function">createCriteria</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">andIn</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Fn</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> field<span class="token punctuation">,</span> fieldValueList<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">deleteByExample</span><span class="token punctuation">(</span>example<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>这个接口展示了好几个通用方法的特点：</p> <ol><li>可以继承其他通用接口</li> <li>可以重写继承接口的定义</li> <li>可以直接复制其他接口中的通用方法定义</li> <li>可以使用 Java8 默认方法灵活实现通用方法</li></ol> <p>在下面内容中，还能看到一个特点，“5. 那就是一个 provider 实现，通过修改接口方法的返回值和入参，就能变身无数个通用方法”，通用方法的实现极其容易。</p> <p>下面开始详细介绍这些特性。</p> <h2 id="_2-1-继承其他通用接口"><a href="#_2-1-继承其他通用接口" class="header-anchor">#</a> 2.1 继承其他通用接口</h2> <p>上面接口定义中，继承了 <code>EntityMapper</code>, <code>ExampleMapper</code> 和 <code>CursorMapper</code> 接口。这些接口中定义了大量的通用方法，
通过继承使得 <code>Mapper</code> 接口获得了大量的通用方法，通过继承可以组合不同类别的方法。</p> <p>除了这里继承的 3 个接口外，还有其他几个接口，一并简单介绍如下。</p> <h3 id="_2-1-1-io-mybatis-mapper-base-entitymapper-t-i"><a href="#_2-1-1-io-mybatis-mapper-base-entitymapper-t-i" class="header-anchor">#</a> 2.1.1  <code>io.mybatis.mapper.base.EntityMapper&lt;T, I&gt;</code></h3> <p>实体类最基础的通用方法：</p> <ul><li><code>int insert(T entity)</code>: 保存实体</li> <li><code>int insertSelective(T entity)</code>: 保存实体中不为空的字段</li> <li><code>int deleteByPrimaryKey(I id)</code>: 根据主键删除</li> <li><code>int delete(T entity)</code>: 保存实体信息批量删除</li> <li><code>int updateByPrimaryKey(T entity)</code>: 根据主键更新实体</li> <li><code>int updateByPrimaryKeySelective(T entity)</code>: 根据主键更新实体中不为空的字段</li> <li><code>Optional&lt;T&gt; selectByPrimaryKey(I id)</code>: 根据主键查询实体</li> <li><code>Optional&lt;T&gt; selectOne(T entity)</code>: 根据实体字段条件查询唯一的实体</li> <li><code>List&lt;T&gt; selectList(T entity)</code>: 根据实体字段条件批量查询</li> <li><code>int selectCount(T entity)</code>: 根据实体字段条件查询总数</li></ul> <p>这个接口中返回值特殊的有两个 <code>Optional&lt;T&gt;</code>，使用的 Java8 中的 <code>Optional</code> 类型，表明接口返回值可能为空，
使用时应该判断或使用 <code>Optional</code> 提供的 <code>orXX</code> 方法，比如下面几种情况：</p> <ol><li>返回值不能为空，为空则抛出异常：<div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> userOptional <span class="token operator">=</span> entityMapper<span class="token punctuation">.</span><span class="token function">selectByPrimaryKey</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> userOptional<span class="token punctuation">.</span><span class="token function">orElseThrow</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;数据不存在&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li>如果不存在，新建一个：<div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> userOptional <span class="token operator">=</span> entityMapper<span class="token punctuation">.</span><span class="token function">selectByPrimaryKey</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> userOptional<span class="token punctuation">.</span><span class="token function">orElseGet</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token operator">::</span><span class="token keyword">new</span><span class="token punctuation">)</span>
</code></pre></div></li> <li>如果不存在，直接返回 null：<div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> userOptional <span class="token operator">=</span> entityMapper<span class="token punctuation">.</span><span class="token function">selectByPrimaryKey</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> userOptional<span class="token punctuation">.</span><span class="token function">orElse</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li></ol> <p>真正使用 <code>Optional</code> 的时候，要尽可能避免以前 <code>obj != null</code> 这种判断思维，避免使用 <code>Optional.isPresent()</code> 判断，才能真正掌握 <code>Optional</code> 的用法。</p> <p>如果你不喜欢上面返回值为 <code>Optional</code>，就想返回 <code>T</code>，后面第 2.5 会介绍实现方式。</p> <h3 id="_2-1-2-io-mybatis-mapper-example-examplemapper-t-e"><a href="#_2-1-2-io-mybatis-mapper-example-examplemapper-t-e" class="header-anchor">#</a> 2.1.2 <code>io.mybatis.mapper.example.ExampleMapper&lt;T, E&gt;</code></h3> <p>Example 类相关的查询方法，Example 中扩展了一些新的方法，因此默认的 Example 查询已经不支持 MBG 生成的 XXExample 对象作为参数。</p> <p>Example的用法请参考: <a href="https://github.com/abel533/Mapper/wiki/6.example" target="_blank" rel="noopener noreferrer">mapper4 example useage doc<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, 注意：这里的example和mapper4的用法也不完全一样，详细用法请参考<a href="https://github.com/mybatis-mapper/mapper/blob/master/mapper/src/test/java/io/mybatis/mapper/example/UserExampleMapperTest.java" target="_blank" rel="noopener noreferrer">example 单元测试<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>先看接口中包含的方法：</p> <ul><li><code>default Example&lt;T&gt; example()</code>: 返回 <code>Example&lt;T&gt;</code> 对象，自己也可以直接 new</li> <li><code>int deleteByExample(E example)</code>: 根据 <code>Example</code> 删除</li> <li><code>int updateByExample(@Param(&quot;entity&quot;) T entity, @Param(&quot;example&quot;) E example)</code>: 根据 <code>Example</code> 条件批量更新实体信息</li> <li><code>int updateByExampleSelective(@Param(&quot;entity&quot;) T entity, @Param(&quot;example&quot;) E example);</code>: 根据 <code>Example</code> 条件批量更新实体不为空的字段</li> <li><code>List&lt;T&gt; selectByExample(E example)</code>: 根据 <code>Example</code> 条件批量查询</li> <li><code>Optional&lt;T&gt; selectOneByExample(E example)</code>: 根据 <code>Example</code> 条件查询单个实体</li> <li><code>int countByExample(E example)</code>: 根据 <code>Example</code> 条件查询总数</li></ul> <p>接口源码中还注释了几个方法，这些方式是用来说明 <strong>2.4</strong> 的特点，这里先不介绍。</p> <p>看完接口方法，在看看 <code>Example</code> 对象中增加了那些特殊的字段和方法：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Example</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
  <span class="token comment">/**
   * 排序字段
   */</span>
  <span class="token keyword">protected</span> <span class="token class-name">String</span>            orderByClause<span class="token punctuation">;</span>
  <span class="token comment">/**
   * 是否使用 distinct
   */</span>
  <span class="token keyword">protected</span> <span class="token keyword">boolean</span>           distinct<span class="token punctuation">;</span>
  <span class="token comment">/**
   * 指定查询列
   */</span>
  <span class="token keyword">protected</span> <span class="token class-name">String</span>            selectColumns<span class="token punctuation">;</span>
  <span class="token comment">/**
   * 起始 SQL，添加到 SQL 前，注意防止 SQL 注入
   */</span>
  <span class="token keyword">protected</span> <span class="token class-name">String</span>            startSql<span class="token punctuation">;</span>
  <span class="token comment">/**
   * 结尾 SQL，添加到 SQL 最后，注意防止 SQL 注入
   */</span>
  <span class="token keyword">protected</span> <span class="token class-name">String</span>            endSql<span class="token punctuation">;</span>
  <span class="token comment">/**
   * 多组条件通过 OR 连接
   */</span>
  <span class="token keyword">protected</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Criteria</span><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> oredCriteria<span class="token punctuation">;</span>
  <span class="token comment">/**
   * 允许Example查询条件为空
   */</span>
  <span class="token keyword">protected</span> <span class="token keyword">boolean</span>           allowCriteriaEmpty<span class="token punctuation">;</span>
  <span class="token comment">//省略其他</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_2-1-2-1-orderbyclause"><a href="#_2-1-2-1-orderbyclause" class="header-anchor">#</a> 2.1.2.1 orderByClause</h4> <p>排序字段是默认就有的，但是为了字段使用的安全，增加了额外的赋值方法：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
 * 通过方法引用方式设置排序字段
 *
 * @param fn    排序列的方法引用
 * @param order 排序方式
 * @return Example
 */</span>
<span class="token keyword">public</span> <span class="token class-name">Example</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">orderBy</span><span class="token punctuation">(</span><span class="token class-name">Fn</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> fn<span class="token punctuation">,</span> <span class="token class-name">Order</span> order<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>orderByClause <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    orderByClause <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  orderByClause <span class="token operator">+=</span> fn<span class="token punctuation">.</span><span class="token function">toColumn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; &quot;</span> <span class="token operator">+</span> order<span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>示例：</p> <div class="language-java extra-class"><pre class="language-java"><code>example<span class="token punctuation">.</span><span class="token function">orderBy</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token operator">::</span><span class="token function">getId</span><span class="token punctuation">,</span> <span class="token class-name">Example<span class="token punctuation">.</span>Order</span><span class="token punctuation">.</span><span class="token constant">DESC</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>这会生成 <code>ORDER BY id desc</code> 排序。</p> <h4 id="_2-1-2-2-distinct"><a href="#_2-1-2-2-distinct" class="header-anchor">#</a> 2.1.2.2 distinct</h4> <p>去重 distinct 也是默认的。如果设置为 <code>true</code>，查询时就会使用 <code>SELECT DISTINCT ...</code>。</p> <h4 id="_2-1-2-3-selectcolumns"><a href="#_2-1-2-3-selectcolumns" class="header-anchor">#</a> 2.1.2.3 selectColumns</h4> <p><code>selectColumns</code> 是新增的，可以用来指定查询列，对应的方法如下：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
 * 指定查询列
 *
 * @param fns 方法引用
 */</span>
<span class="token keyword">public</span> <span class="token class-name">Example</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">selectColumns</span><span class="token punctuation">(</span><span class="token class-name">Fn</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> fns<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>selectColumns <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    selectColumns <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Fn</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> fn <span class="token operator">:</span> fns<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> column <span class="token operator">=</span> fn<span class="token punctuation">.</span><span class="token function">toColumn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> field <span class="token operator">=</span> fn<span class="token punctuation">.</span><span class="token function">toField</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>selectColumns<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      selectColumns <span class="token operator">+=</span> <span class="token string">&quot;,&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>column<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>field<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      selectColumns <span class="token operator">+=</span> column<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      selectColumns <span class="token operator">+=</span> column <span class="token operator">+</span> <span class="token string">&quot; AS &quot;</span> <span class="token operator">+</span> field<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>用法示例：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> example <span class="token operator">=</span> exampleMapper<span class="token punctuation">.</span><span class="token function">example</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
example<span class="token punctuation">.</span><span class="token function">selectColumns</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token operator">::</span><span class="token function">getUserName</span><span class="token punctuation">,</span> <span class="token class-name">User</span><span class="token operator">::</span><span class="token function">getSex</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//可以多次调用追加查询列</span>
example<span class="token punctuation">.</span><span class="token function">selectColumns</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token operator">::</span><span class="token function">getId</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>指定查询列后，在 SQL 中会变成 <code>select name as userName, sex, id from ...</code>（<code>userName</code> 映射的 <code>name</code>）。</p> <h4 id="_2-1-2-4-startsql"><a href="#_2-1-2-4-startsql" class="header-anchor">#</a> 2.1.2.4 startSql</h4> <p>新增加的字段，起始 SQL，添加到 SQL 前，<strong>注意防止 SQL 注入。</strong></p> <p>直接通过 set 方法设置值：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
 * 设置起始 SQL
 *
 * @param startSql 起始 SQL，添加到 SQL 前，注意防止 SQL 注入
 */</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setStartSql</span><span class="token punctuation">(</span><span class="token class-name">String</span> startSql<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>startSql <span class="token operator">=</span> startSql<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这个字段基本上要配合下面的 <code>endSql</code> 字段一起用，下面示例：</p> <div class="language-java extra-class"><pre class="language-java"><code>example<span class="token punctuation">.</span><span class="token function">setStartSql</span><span class="token punctuation">(</span><span class="token string">&quot;select * from (&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
example<span class="token punctuation">.</span><span class="token function">setEndSql</span><span class="token punctuation">(</span><span class="token string">&quot;) tmp limit 1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>示例没太大意义，你可以想个更好的例子来更新此处文档。</p> <h4 id="_2-1-2-5-endsql"><a href="#_2-1-2-5-endsql" class="header-anchor">#</a> 2.1.2.5 endSql</h4> <p>和上面新增加的字段类似：结尾 SQL，添加到 SQL 最后，注意防止 SQL 注入</p> <p>也是直接通过 set 方法设置：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
 * 设置结尾 SQL
 *
 * @param endSql 结尾 SQL，添加到 SQL 最后，注意防止 SQL 注入
 */</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setEndSql</span><span class="token punctuation">(</span><span class="token class-name">String</span> endSql<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>endSql <span class="token operator">=</span> endSql<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>示例看前一个字段的。</p> <h4 id="_2-1-2-6-oredcriteria"><a href="#_2-1-2-6-oredcriteria" class="header-anchor">#</a> 2.1.2.6 oredCriteria</h4> <p>默认就有的字段，记录查询条件块。</p> <h4 id="_2-1-2-7-allowcriteriaempty"><a href="#_2-1-2-7-allowcriteriaempty" class="header-anchor">#</a> 2.1.2.7 allowCriteriaEmpty</h4> <p>这个字段是新增的，这个字段破坏了 Example 的整体结构，主要目的是在使用时决定：是否允许查询条件为空</p> <p>当 select 查询时，是可以为空的，这种情况就是查询了全表，由于这个字段默认值为 <code>false</code> 不允许，因此你需要 <code>new Example(true)</code> 才行。</p> <p>当 delete, update 时，默认不允许为空，这可以避免清库和更新全库。这个参数只在下面方法用到：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
 * 获取所有条件，当前方法会校验所有查询条件，如果不存在查询条件就抛出异常。
 * &lt;p&gt;
 * 不允许通过 Example 相关方法操作全表！！！
 *
 * @return 条件
 */</span>
<span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Criteria</span><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">getOredCriteria</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>allowCriteriaEmpty<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>oredCriteria<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">&quot;Example 条件不能为空&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">boolean</span> noCriteria <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Criteria</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> criteria <span class="token operator">:</span> oredCriteria<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>criteria<span class="token punctuation">.</span><span class="token function">getCriteria</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        noCriteria <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>noCriteria<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">&quot;Example 条件不能为空&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> oredCriteria<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>当获取查询条件时判断，如果没有有效的查询条件，就抛出异常，避免潜在的风险。</p> <h4 id="_2-1-2-7-clear-方法"><a href="#_2-1-2-7-clear-方法" class="header-anchor">#</a> 2.1.2.7 <code>clear()</code> 方法</h4> <p>最后说一个方法，同一个 <code>Example</code> 对象经过 <code>clear()</code> 后是可以反复使用的：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
 * 清除所有设置
 */</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  oredCriteria<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  orderByClause <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  distinct <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  selectColumns <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  startSql <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  endSql <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  allowCriteriaEmpty <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>特别注意的是 <code>allowCriteriaEmpty</code>，即使你用 <code>Example(true)</code> 创建的，这里也会设置为 <code>false</code>，想要设置 <code>true</code> 可以调用下面方法：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
 * 设置是否允许查询条件为空
 *
 * @param allowCriteriaEmpty true允许空，一般用于查询，false不允许空，一般用于修改和删除
 */</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">allowCriteriaEmpty</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> allowCriteriaEmpty<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>allowCriteriaEmpty <span class="token operator">=</span> allowCriteriaEmpty<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_2-1-2-8-简单示例"><a href="#_2-1-2-8-简单示例" class="header-anchor">#</a> 2.1.2.8 简单示例</h4> <p>介绍完所有字段和一个特殊方法，下面看几个 <code>Example</code> 示例：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Example</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> example <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Example</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
example<span class="token punctuation">.</span><span class="token function">createCriteria</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">andGreaterThan</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token operator">::</span><span class="token function">getId</span><span class="token punctuation">,</span> <span class="token number">10L</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">andLike</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token operator">::</span><span class="token function">getUserName</span><span class="token punctuation">,</span> <span class="token string">&quot;殷%&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> exampleMapper<span class="token punctuation">.</span><span class="token function">deleteByExample</span><span class="token punctuation">(</span>example<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

example<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
example<span class="token punctuation">.</span><span class="token function">createCriteria</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">andEqualTo</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token operator">::</span><span class="token function">getId</span><span class="token punctuation">,</span> <span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
user<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
user<span class="token punctuation">.</span><span class="token function">setUserName</span><span class="token punctuation">(</span><span class="token string">&quot;男主角&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> exampleMapper<span class="token punctuation">.</span><span class="token function">updateByExample</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> example<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>剩下的，你需要掌握的就是 <code>andGreaterThan</code> 和 <code>andEqualTo</code> 这类的方法，这些方法通过名字可以直接理解。</p> <h3 id="_2-1-3-io-mybatis-mapper-cursor-cursormapper-t-e"><a href="#_2-1-3-io-mybatis-mapper-cursor-cursormapper-t-e" class="header-anchor">#</a> 2.1.3 <code>io.mybatis.mapper.cursor.CursorMapper&lt;T, E&gt;</code></h3> <p>游标相关的功能，是在 2016年初的 MyBatis 3.3.1 中增加的，当你想逐个从数据库取值时可以使用。</p> <p>通用方法中，仅提供了两个方法示例：</p> <ul><li><code>Cursor&lt;T&gt; selectCursor(T entity)</code>: 根据实体字段条件查询</li> <li><code>Cursor&lt;T&gt; selectCursorByExample(E example)</code>：根据 Example 条件查询</li></ul> <p>这两个方法就提现了 “5. 那就是一个 provider 实现，通过修改接口方法的返回值和入参，就能变身无数个通用方法”，
这两个接口使用了 <code>EntityProvider</code> 和 <code>ExampleProvider</code> 中的现成实现，只是把返回值从 <code>List&lt;T&gt;</code> 改成了 <code>Cursor&lt;T&gt;</code>。</p> <p>一个简单的示例如下：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testSelectCursor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token class-name">SqlSession</span> sqlSession <span class="token operator">=</span> <span class="token function">getSqlSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token class-name">CursorMapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">,</span> <span class="token class-name">Example</span><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> mapper <span class="token operator">=</span> sqlSession<span class="token punctuation">.</span><span class="token function">getMapper</span><span class="token punctuation">(</span><span class="token class-name">UserMapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    user<span class="token punctuation">.</span><span class="token function">setSex</span><span class="token punctuation">(</span><span class="token string">&quot;女&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Cursor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> userCursor <span class="token operator">=</span> mapper<span class="token punctuation">.</span><span class="token function">selectCursor</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Iterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> userIterator <span class="token operator">=</span> userCursor<span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>userIterator<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      count<span class="token operator">++</span><span class="token punctuation">;</span>
      <span class="token class-name">User</span> u <span class="token operator">=</span> userIterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>u<span class="token punctuation">.</span><span class="token function">getUserName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span>count<span class="token punctuation">,</span> userCursor<span class="token punctuation">.</span><span class="token function">getCurrentIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span>userCursor<span class="token punctuation">.</span><span class="token function">isConsumed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
    <span class="token comment">//不要忘记关闭sqlSession</span>
    sqlSession<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_2-1-4-io-mybatis-mapper-fn-fnmapper-t"><a href="#_2-1-4-io-mybatis-mapper-fn-fnmapper-t" class="header-anchor">#</a> 2.1.4 <code>io.mybatis.mapper.fn.FnMapper&lt;T&gt;</code></h3> <p>这个接口主要目的是为了演示如果通过传入字段改变查询的逻辑。接口包含下面几个方法：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">FnMapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

  <span class="token comment">/**
   * 根据主键更新实体中不为空的字段，强制字段不区分是否 null，都更新
   *
   * @param entity            实体类
   * @param forceUpdateFields 强制更新的字段，不区分字段是否为 null，通过 {@link Fn#of(Fn...)} 创建 {@link Fn.Fns}
   * @return 1成功，0失败
   */</span>
  <span class="token annotation punctuation">@Lang</span><span class="token punctuation">(</span><span class="token class-name">Caching</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
  <span class="token annotation punctuation">@UpdateProvider</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">FnProvider</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> method <span class="token operator">=</span> <span class="token string">&quot;updateByPrimaryKeySelectiveWithForceFields&quot;</span><span class="token punctuation">)</span>
  <span class="token keyword">int</span> <span class="token function">updateByPrimaryKeySelectiveWithForceFields</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">&quot;entity&quot;</span><span class="token punctuation">)</span> <span class="token class-name">T</span> entity<span class="token punctuation">,</span> <span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">&quot;fns&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Fn<span class="token punctuation">.</span>Fns</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> forceUpdateFields<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/**
   * 根据实体字段条件查询唯一的实体（{@link io.mybatis.mapper.example.ExampleMapper} 可以实现一样的功能，当前方法只是示例）
   *
   * @param entity       实体类
   * @param selectFileds 查询的字段，不区分字段是否为 null，通过 {@link Fn#of(Fn...)} 创建 {@link Fn.Fns}
   * @return 单个实体，查询结果由多条时报错
   */</span>
  <span class="token annotation punctuation">@Lang</span><span class="token punctuation">(</span><span class="token class-name">Caching</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
  <span class="token annotation punctuation">@SelectProvider</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">FnProvider</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> method <span class="token operator">=</span> <span class="token string">&quot;selectColumns&quot;</span><span class="token punctuation">)</span>
  <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">selectColumnsOne</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">&quot;entity&quot;</span><span class="token punctuation">)</span> <span class="token class-name">T</span> entity<span class="token punctuation">,</span> <span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">&quot;fns&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Fn<span class="token punctuation">.</span>Fns</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> selectFileds<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/**
   * 根据实体字段条件批量查询（{@link io.mybatis.mapper.example.ExampleMapper} 可以实现一样的功能，当前方法只是示例）
   *
   * @param entity       实体类
   * @param selectFileds 查询的字段，不区分字段是否为 null，通过 {@link Fn#of(Fn...)} 创建 {@link Fn.Fns}
   * @return 实体列表
   */</span>
  <span class="token annotation punctuation">@Lang</span><span class="token punctuation">(</span><span class="token class-name">Caching</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
  <span class="token annotation punctuation">@SelectProvider</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">FnProvider</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> method <span class="token operator">=</span> <span class="token string">&quot;selectColumns&quot;</span><span class="token punctuation">)</span>
  <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">selectColumns</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">&quot;entity&quot;</span><span class="token punctuation">)</span> <span class="token class-name">T</span> entity<span class="token punctuation">,</span> <span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">&quot;fns&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Fn<span class="token punctuation">.</span>Fns</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> selectFileds<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>第一个方法名有点长，用列表展示不太合适了。</p></blockquote> <p>这几个方法，都可以通过传入字段改变行为，并且第一个名字最长的方法，直接被复制到了 <code>Mapper</code> 接口的定义中，这就是第 3 点要说明的内容，
实际上你可以复制粘贴的方式构造一个自己的基类 Mapper。2.3 在介绍。</p> <p>名字最长这个方法是许多人想要的一个方法，在选择更新的情况下还能指定必须更新的字段，这个方法的示例如下：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">User</span> user <span class="token operator">=</span> mapper<span class="token punctuation">.</span><span class="token function">selectByPrimaryKey</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
user<span class="token punctuation">.</span><span class="token function">setUserName</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> count <span class="token operator">=</span> mapper<span class="token punctuation">.</span><span class="token function">updateByPrimaryKeySelectiveWithForceFields</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> <span class="token class-name">Fn</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token operator">::</span><span class="token function">getUserName</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>单纯从 Mapper 接口调用来看，这个方法名字太长，写法也有点别扭，等看到后续 Service 层封装时，
会掩盖这些不舒服的地方，会变得更简洁，例如 Service 中的接口定义：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
 * 更新（非空字段），指定的强制更新字段不区分是否为空
 *
 * @param entity            实体类
 * @param forceUpdateFields 强制更新的字段，不区分字段是否为 null
 * @return 返回更新成功后的实体，远程服务调用时，由于序列化和反序列化，入参和返回值不是同一个对象
 */</span>
<span class="token class-name">T</span> <span class="token function">updateSelective</span><span class="token punctuation">(</span><span class="token class-name">T</span> entity<span class="token punctuation">,</span> <span class="token class-name">Fn</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> forceUpdateFields<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>调用的示例：</p> <div class="language-java extra-class"><pre class="language-java"><code>userService<span class="token punctuation">.</span><span class="token function">updateSelective</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> <span class="token class-name">User</span><span class="token operator">::</span><span class="token function">getName</span><span class="token punctuation">,</span> <span class="token class-name">User</span><span class="token operator">::</span><span class="token function">getRoleId</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_2-1-5-io-mybatis-mapper-list-listmapper-t"><a href="#_2-1-5-io-mybatis-mapper-list-listmapper-t" class="header-anchor">#</a> 2.1.5 <code>io.mybatis.mapper.list.ListMapper&lt;T&gt;</code></h3> <p>这个接口算示例，没有包含在 <code>Mapper</code> 中，提供下面一个方法：</p> <ul><li><code>int insertList(@Param(&quot;entityList&quot;) List&lt;? extends T&gt; entityList);</code>: 批量插入</li></ul> <p>需要数据库支持 <code>INSERT TABLE(C1,C2...) VALUES(...), (....)</code> 语法才可以。</p> <h2 id="_2-2-重写继承接口的定义"><a href="#_2-2-重写继承接口的定义" class="header-anchor">#</a> 2.2 重写继承接口的定义</h2> <p>在 <code>EntityMapper</code> 中有 <code>insert</code> 方法定义如下：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
 * 保存实体
 *
 * @param entity 实体类
 * @return 1成功，0失败
 */</span>
<span class="token annotation punctuation">@Lang</span><span class="token punctuation">(</span><span class="token class-name">Caching</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@InsertProvider</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">EntityProvider</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> method <span class="token operator">=</span> <span class="token string">&quot;insert&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">int</span> <span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">T</span> entity<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>这个定义没有处理主键，需要自己设置好主键后调用该方法新增数据。</p> <p>如果我使用的 MySql 自增怎么办？主键null也能直接保存，但是不回写。</p> <p>如果使用 Oracle 序列怎么办？直接用这个方法是没有办法的。</p> <p>因为可以 <strong>重写继承接口的定义</strong>，所以可以支持所有 MyBatis 本身能支持的所有主键方式。</p> <p>在 <code>Mapper</code> 中，覆盖定义如下：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
 * 保存实体，默认主键自增，并且名称为 id
 * &lt;p&gt;
 * 这个方法是个示例，你可以在自己的接口中使用相同的方式覆盖父接口中的配置
 *
 * @param entity 实体类
 * @return 1成功，0失败
 */</span>
<span class="token annotation punctuation">@Override</span>
<span class="token annotation punctuation">@Lang</span><span class="token punctuation">(</span><span class="token class-name">Caching</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Options</span><span class="token punctuation">(</span>useGeneratedKeys <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span> keyProperty <span class="token operator">=</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@InsertProvider</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">EntityProvider</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> method <span class="token operator">=</span> <span class="token string">&quot;insert&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">int</span> <span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">T</span> entity<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>首先 <code>@Override</code> 是重写父接口定义，然后和原来相比增加了下面的注解：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Options</span><span class="token punctuation">(</span>useGeneratedKeys <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span> keyProperty <span class="token operator">=</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span>
</code></pre></div><p>这个注解对应 xml 中的配置如下：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>insert</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>insert<span class="token punctuation">&quot;</span></span> <span class="token attr-name">useGeneratedKeys</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token attr-name">keyProperty</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>id<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><code>useGeneratedKeys</code> 意思是要用JDBC接口方式取回主键，主键字段对应的属性名为 <code>id</code>，就是要回写到 <code>id</code> 字段。</p> <p>上面的配置对 MySQL 这类自增数据库是可行的，如果你自己的主键不叫 <code>id</code>，甚至如果每个表的主键都不统一（如 <code>{tableName}_id</code>），
你需要在每个具体实现的接口中重写。例如：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserMapper</span> <span class="token keyword">extends</span> <span class="token class-name">Mapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
  <span class="token comment">/**
   * 保存实体，默认主键自增，并且名称为 id
   * &lt;p&gt;
   * 这个方法是个示例，你可以在自己的接口中使用相同的方式覆盖父接口中的配置
   *
   * @param entity 实体类
   * @return 1成功，0失败
   */</span>
  <span class="token annotation punctuation">@Override</span>
  <span class="token annotation punctuation">@Lang</span><span class="token punctuation">(</span><span class="token class-name">Caching</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
  <span class="token annotation punctuation">@Options</span><span class="token punctuation">(</span>useGeneratedKeys <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span> keyProperty <span class="token operator">=</span> <span class="token string">&quot;userId&quot;</span><span class="token punctuation">)</span>
  <span class="token annotation punctuation">@InsertProvider</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">EntityProvider</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> method <span class="token operator">=</span> <span class="token string">&quot;insert&quot;</span><span class="token punctuation">)</span>
  <span class="token keyword">int</span> <span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">User</span> entity<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre></div><p>如果是Oracle序列或者需要执行SQL生成主键或者取回主键时，可以配置 <code>@SelectKey</code> 注解，示例如下：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token annotation punctuation">@Lang</span><span class="token punctuation">(</span><span class="token class-name">Caching</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@SelectKey</span><span class="token punctuation">(</span>statement <span class="token operator">=</span> <span class="token string">&quot;CALL IDENTITY()&quot;</span><span class="token punctuation">,</span> keyProperty <span class="token operator">=</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> resultType <span class="token operator">=</span> <span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> before <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@InsertProvider</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">EntityProvider</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> method <span class="token operator">=</span> <span class="token string">&quot;insert&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">int</span> <span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">User</span> entity<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>上面还只是通过增加注解重新定义了接口方法。实际上你还可以更换 <code>@InsertProvider(type = EntityProvider.class, method = &quot;insert&quot;)</code>，
将其中的实现换成其他的也可以，如果对默认的方法和逻辑不满意，就可以改成别的。</p> <p>通过 <strong>重写继承接口的定义</strong>，应该能感觉出有多强大，多么灵活。</p> <h2 id="_2-3-复制其他接口中的通用方法定义"><a href="#_2-3-复制其他接口中的通用方法定义" class="header-anchor">#</a> 2.3 复制其他接口中的通用方法定义</h2> <p>这是最灵活的一点，在 <code>Mapper</code> 中直接复制了 <code>FnMapper</code> 的一个方法：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
 * 根据主键更新实体中不为空的字段，强制字段不区分是否 null，都更新
 * &lt;p&gt;
 * 当前方法来自 {@link io.mybatis.mapper.fn.FnMapper}，该接口中的其他方法用 {@link ExampleMapper} 也能实现
 *
 * @param entity            实体类
 * @param forceUpdateFields 强制更新的字段，不区分字段是否为 null，通过 {@link Fn#of(Fn...)} 创建 {@link Fn.Fns}
 * @return 1成功，0失败
 */</span>
<span class="token annotation punctuation">@Lang</span><span class="token punctuation">(</span><span class="token class-name">Caching</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@UpdateProvider</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">FnProvider</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> method <span class="token operator">=</span> <span class="token string">&quot;updateByPrimaryKeySelectiveWithForceFields&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">int</span> <span class="token function">updateByPrimaryKeySelectiveWithForceFields</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">&quot;entity&quot;</span><span class="token punctuation">)</span> <span class="token class-name">T</span> entity<span class="token punctuation">,</span> <span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">&quot;fns&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Fn<span class="token punctuation">.</span>Fns</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> forceUpdateFields<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>这就是完全的复制粘贴，利用这一点，你可以不用 <code>Mapper</code> 接口作为自己的基类接口，你可以定义一个自己的接口，复制粘贴自己的需要的通用方法作为基础接口，
例如一个 <code>GuozilanMapper</code> 示例如下：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">GuozilanMapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
  
  <span class="token comment">/**
   * 保存实体
   *
   * @param entity 实体类
   * @return 1成功，0失败
   */</span>
  <span class="token annotation punctuation">@Lang</span><span class="token punctuation">(</span><span class="token class-name">Caching</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
  <span class="token annotation punctuation">@InsertProvider</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">EntityProvider</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> method <span class="token operator">=</span> <span class="token string">&quot;insert&quot;</span><span class="token punctuation">)</span>
  <span class="token keyword">int</span> <span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">T</span> entity<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/**
   * 根据主键查询实体
   *
   * @param id 主键
   * @return 实体
   */</span>
  <span class="token annotation punctuation">@Lang</span><span class="token punctuation">(</span><span class="token class-name">Caching</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
  <span class="token annotation punctuation">@SelectProvider</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">EntityProvider</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> method <span class="token operator">=</span> <span class="token string">&quot;selectByPrimaryKey&quot;</span><span class="token punctuation">)</span>
  <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">selectByPrimaryKey</span><span class="token punctuation">(</span><span class="token class-name">Long</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>只要继承了上面的接口，你就直接拥有了这两个基础方法。</p> <blockquote><p>使用这种方式可以自定义一些自己项目需要用到的不同类别的通用接口，例如，如果你有大量实体都没有主键，默认的 <code>Mapper&lt;T, I&gt;</code> 就不太适合，
此时你可以自己创建一个 <code>NoIdMapper&lt;T&gt;</code>，把除了主键操作方法外的其他方法（有选择的）都拷过来，就形成了符合自己实际需要的通用 Mapper。</p></blockquote> <p>推而广之之后，还有更绝的用法，不继承接口，或者基础接口没有某个方法，直接复制注解过来，不需要自己写 XML：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserMapper</span> <span class="token punctuation">{</span>

   <span class="token comment">/**
    * 保存实体
    *
    * @param entity 实体类
    * @return 1成功，0失败
   */</span>
  <span class="token annotation punctuation">@Lang</span><span class="token punctuation">(</span><span class="token class-name">Caching</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
  <span class="token annotation punctuation">@InsertProvider</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">EntityProvider</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> method <span class="token operator">=</span> <span class="token string">&quot;insert&quot;</span><span class="token punctuation">)</span>
  <span class="token keyword">int</span> <span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">User</span> entity<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>你不需要任何具体的 SQL，上面的 insert 方法就可以直接使用了。</p> <blockquote><p>后期长远规划中，会利用 3.5.6 中的一些功能，直接配置一个 <code>@InsertProvider</code> 就能使用，不需要配置 <code>type</code> 和 <code>method</code>。
在更长远的规划中，可以直接支持 JPA 中的方法名查询，例如
<code>getByNameEqualAndAgeLessThen(@Param(&quot;name&quot;) String name, @Param(&quot;age&quot;) Integer age)</code>
直接根据方法名生成一个 SQL。</p></blockquote> <h2 id="_2-4-使用-java8-默认方法灵活实现通用方法"><a href="#_2-4-使用-java8-默认方法灵活实现通用方法" class="header-anchor">#</a> 2.4 使用 Java8 默认方法灵活实现通用方法</h2> <p>在 <code>Mapper</code> 接口中，利用现有的 <code>Example</code> 方法，实现了两个非常常用的通用方法：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
 * 根据指定字段集合查询：field in (fieldValueList)
 * &lt;p&gt;
 * 这个方法是个示例，你也可以使用 Java8 的默认方法实现一些通用方法
 *
 * @param field          字段
 * @param fieldValueList 字段值集合
 * @param &lt;F&gt;            字段类型
 * @return 实体列表
 */</span>
<span class="token keyword">default</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">F</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">selectByFieldList</span><span class="token punctuation">(</span><span class="token class-name">Fn</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">F</span><span class="token punctuation">&gt;</span></span> field<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">F</span><span class="token punctuation">&gt;</span></span> fieldValueList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token class-name">Example</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> example <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Example</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  example<span class="token punctuation">.</span><span class="token function">createCriteria</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">andIn</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Fn</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> field<span class="token punctuation">,</span> fieldValueList<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token function">selectByExample</span><span class="token punctuation">(</span>example<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * 根据指定字段集合删除：field in (fieldValueList)
 * &lt;p&gt;
 * 这个方法是个示例，你也可以使用 Java8 的默认方法实现一些通用方法
 *
 * @param field          字段
 * @param fieldValueList 字段值集合
 * @param &lt;F&gt;            字段类型
 * @return 实体列表
 */</span>
<span class="token keyword">default</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">F</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">int</span> <span class="token function">deleteByFieldList</span><span class="token punctuation">(</span><span class="token class-name">Fn</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">F</span><span class="token punctuation">&gt;</span></span> field<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">F</span><span class="token punctuation">&gt;</span></span> fieldValueList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token class-name">Example</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> example <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Example</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  example<span class="token punctuation">.</span><span class="token function">createCriteria</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">andIn</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Fn</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> field<span class="token punctuation">,</span> fieldValueList<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token function">deleteByExample</span><span class="token punctuation">(</span>example<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这两个方法可以直接根据某个字段值的集合进行批量查询或者删除，用法示例如下：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> users <span class="token operator">=</span> mapper<span class="token punctuation">.</span><span class="token function">selectByFieldList</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token operator">::</span><span class="token function">getUserName</span><span class="token punctuation">,</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token string">&quot;张无忌&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;赵敏&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;周芷若&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
mapper<span class="token punctuation">.</span><span class="token function">deleteByFieldList</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token operator">::</span><span class="token function">getUserName</span><span class="token punctuation">,</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token string">&quot;张无忌&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;赵敏&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;周芷若&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>除了这个例子外，还有一段 <code>EntityMapper</code> 被注释的示例：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
 * 根据实体字段条件分页查询
 *
 * @param entity    实体类
 * @param rowBounds 分页信息
 * @return 实体列表
 */</span><span class="token operator">/</span><span class="token operator">*</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">selectList</span><span class="token punctuation">(</span><span class="token class-name">T</span> entity<span class="token punctuation">,</span> <span class="token class-name">RowBounds</span> rowBounds<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token operator">*</span><span class="token comment">//**</span>
 <span class="token operator">*</span> 根据查询条件获取第一个结果
 <span class="token operator">*</span>
 <span class="token operator">*</span> <span class="token annotation punctuation">@param</span> entity 实体类
 <span class="token operator">*</span> <span class="token annotation punctuation">@return</span> 实体
 <span class="token operator">*</span><span class="token comment">//*</span>
<span class="token keyword">default</span> <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">selectFirst</span><span class="token punctuation">(</span><span class="token class-name">T</span> entity<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> entities <span class="token operator">=</span> <span class="token function">selectList</span><span class="token punctuation">(</span>entity<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">RowBounds</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>entities<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token class-name">Optional</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>entities<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token class-name">Optional</span><span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token operator">*</span><span class="token comment">//**</span>
 <span class="token operator">*</span> 根据查询条件获取指定的前几个对象
 <span class="token operator">*</span>
 <span class="token operator">*</span> <span class="token annotation punctuation">@param</span> entity 实体类
 <span class="token operator">*</span> <span class="token annotation punctuation">@param</span> n      指定的个数
 <span class="token operator">*</span> <span class="token annotation punctuation">@return</span> 实体
 <span class="token operator">*</span><span class="token comment">//*</span>
<span class="token keyword">default</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">selectTopN</span><span class="token punctuation">(</span><span class="token class-name">T</span> entity<span class="token punctuation">,</span> <span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">selectList</span><span class="token punctuation">(</span>entity<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">RowBounds</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>合理的通过 Java8 的默认方法，能够实现海量的通用方法。至于那些是真正需要用到的通用方法，就需要根据自己的需要来选择，因此虽然上面的方法能通用，
但是在缺乏频繁使用场景的情况下，<code>Mapper</code> 接口并没有接纳这几个方法。</p> <h2 id="_2-5-通过修改接口方法的返回值和入参-就能变身无数个通用方法"><a href="#_2-5-通过修改接口方法的返回值和入参-就能变身无数个通用方法" class="header-anchor">#</a> 2.5 通过修改接口方法的返回值和入参，就能变身无数个通用方法</h2> <p>以 <code>EntityProvider</code> 中的 <code>select</code> 方法为例，方法的具体实现如下：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
 * 根据实体字段条件查询唯一的实体，根据实体字段条件批量查询，查询结果的数量由方法定义
 *
 * @param providerContext 上下文
 * @return cacheKey
 */</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">select</span><span class="token punctuation">(</span><span class="token class-name">ProviderContext</span> providerContext<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token class-name">SqlScript</span><span class="token punctuation">.</span><span class="token function">caching</span><span class="token punctuation">(</span>providerContext<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">SqlScript</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getSql</span><span class="token punctuation">(</span><span class="token class-name">EntityTable</span> entity<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token string">&quot;SELECT &quot;</span> <span class="token operator">+</span> entity<span class="token punctuation">.</span><span class="token function">baseColumnAsPropertyList</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token operator">+</span> <span class="token string">&quot; FROM &quot;</span> <span class="token operator">+</span> entity<span class="token punctuation">.</span><span class="token function">table</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token operator">+</span> <span class="token function">ifParameterNotNull</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span>
          <span class="token function">where</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span>
              entity<span class="token punctuation">.</span><span class="token function">whereColumns</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>column <span class="token operator">-&gt;</span>
                  <span class="token function">ifTest</span><span class="token punctuation">(</span>column<span class="token punctuation">.</span><span class="token function">notNullTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token string">&quot;AND &quot;</span> <span class="token operator">+</span> column<span class="token punctuation">.</span><span class="token function">columnEqualsProperty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
              <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">joining</span><span class="token punctuation">(</span><span class="token constant">LF</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span>
          <span class="token operator">+</span> entity<span class="token punctuation">.</span><span class="token function">groupByColumn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">orElse</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span>
          <span class="token operator">+</span> entity<span class="token punctuation">.</span><span class="token function">havingColumn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">orElse</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span>
          <span class="token operator">+</span> entity<span class="token punctuation">.</span><span class="token function">orderByColumn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">orElse</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>最终会生成一个 <code>SELECT .. FROM .. WHERE ...</code> 的 SQL，在 MyBatis 中，SQL 只定义了如何在数据库执行，
执行后的结果和取值方式是通过接口方法定义决定的，因此就这样一个 SELECT 查询，能够实现很多个方法，举例如下：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Lang</span><span class="token punctuation">(</span><span class="token class-name">Caching</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@SelectProvider</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">EntityProvider</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> method <span class="token operator">=</span> <span class="token string">&quot;select&quot;</span><span class="token punctuation">)</span>
<span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">selectOne</span><span class="token punctuation">(</span><span class="token class-name">T</span> entity<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Lang</span><span class="token punctuation">(</span><span class="token class-name">Caching</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@SelectProvider</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">EntityProvider</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> method <span class="token operator">=</span> <span class="token string">&quot;select&quot;</span><span class="token punctuation">)</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">selectList</span><span class="token punctuation">(</span><span class="token class-name">T</span> entity<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Lang</span><span class="token punctuation">(</span><span class="token class-name">Caching</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@SelectProvider</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">EntityProvider</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> method <span class="token operator">=</span> <span class="token string">&quot;select&quot;</span><span class="token punctuation">)</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">selectAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Lang</span><span class="token punctuation">(</span><span class="token class-name">Caching</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@SelectProvider</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">EntityProvider</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> method <span class="token operator">=</span> <span class="token string">&quot;select&quot;</span><span class="token punctuation">)</span>
<span class="token class-name">Cursor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">selectCursor</span><span class="token punctuation">(</span><span class="token class-name">T</span> entity<span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre></div><p>利用这一特点，通过修改接口方法的返回值和入参，就能变身无数个通用方法。</p> <blockquote><p>如果在加个 <code>RowBounds</code> 分页参数，直接翻倍。</p></blockquote></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/mybatis-mapper/mapper-docs/edit/master/docs/2.mybatis-mapper.md" target="_blank" rel="noopener noreferrer">帮助我们改善此页面！</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">最后编辑时间:</span> <span class="time">5/26/2023, 8:42:54 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/docs/1.getting-started.html" class="prev">
        1.快速上手
      </a></span> <span class="next"><a href="/docs/3.entity.html">
        3. 实体类注解
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.982d0a79.js" defer></script><script src="/assets/js/2.05c8fd45.js" defer></script><script src="/assets/js/11.65baf78c.js" defer></script>
  </body>
</html>
